<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>memory.helpers &#8212;  Source.Python  v742 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=2780edc4" />
    
    <script src="../../_static/documentation_options.js?v=12c636f2"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="icon" href="../../_static/sp_wiki_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html"> Source.Python  v742 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../memory.html" accesskey="U">memory</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">memory.helpers</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for memory.helpers</h1><div class="highlight"><pre>
<span></span><span class="c1"># ../memory/helpers.py</span>

<span class="sd">&quot;&quot;&quot;Provides helper classes/functions for memory functionality.&quot;&quot;&quot;</span>

<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; IMPORTS</span>
<span class="c1"># =============================================================================</span>
<span class="c1"># Python</span>
<span class="c1">#   Binascii</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">binascii</span>

<span class="c1"># Source.Python</span>
<span class="c1">#   Core</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">core</span><span class="w"> </span><span class="kn">import</span> <span class="n">PLATFORM</span>
<span class="c1">#   Memory</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">Convention</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">Function</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pointer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_SIZES</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_object</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; ALL DECLARATION</span>
<span class="c1"># =============================================================================</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Array&#39;</span><span class="p">,</span>
           <span class="s1">&#39;BasePointer&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Key&#39;</span><span class="p">,</span>
           <span class="s1">&#39;MemberFunction&#39;</span><span class="p">,</span>
           <span class="s1">&#39;NO_DEFAULT&#39;</span><span class="p">,</span>
           <span class="s1">&#39;Type&#39;</span><span class="p">,</span>
           <span class="s1">&#39;parse_data&#39;</span><span class="p">,</span>
           <span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; Type</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="Type">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Type">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Type</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stores attribute/array types.&quot;&quot;&quot;</span>

    <span class="n">BOOL</span> <span class="o">=</span> <span class="s1">&#39;bool&#39;</span>
    <span class="n">CHAR</span> <span class="o">=</span> <span class="s1">&#39;char&#39;</span>
    <span class="n">UCHAR</span> <span class="o">=</span> <span class="s1">&#39;uchar&#39;</span>
    <span class="n">SHORT</span> <span class="o">=</span> <span class="s1">&#39;short&#39;</span>
    <span class="n">USHORT</span> <span class="o">=</span> <span class="s1">&#39;ushort&#39;</span>
    <span class="n">INT</span> <span class="o">=</span> <span class="s1">&#39;int&#39;</span>
    <span class="n">UINT</span> <span class="o">=</span> <span class="s1">&#39;uint&#39;</span>
    <span class="n">LONG</span> <span class="o">=</span> <span class="s1">&#39;long&#39;</span>
    <span class="n">ULONG</span> <span class="o">=</span> <span class="s1">&#39;ulong&#39;</span>
    <span class="n">LONG_LONG</span> <span class="o">=</span> <span class="s1">&#39;long_long&#39;</span>
    <span class="n">ULONG_LONG</span> <span class="o">=</span> <span class="s1">&#39;ulong_long&#39;</span>
    <span class="n">FLOAT</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span>
    <span class="n">DOUBLE</span> <span class="o">=</span> <span class="s1">&#39;double&#39;</span>
    <span class="n">POINTER</span> <span class="o">=</span> <span class="s1">&#39;pointer&#39;</span>
    <span class="n">STRING_POINTER</span> <span class="o">=</span> <span class="s1">&#39;string_pointer&#39;</span>
    <span class="n">STRING_ARRAY</span> <span class="o">=</span> <span class="s1">&#39;string_array&#39;</span>

<div class="viewcode-block" id="Type.is_native">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Type.is_native">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_native</span><span class="p">(</span><span class="n">type_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return True if the given type name is a native type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">type_name</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span></div>
</div>



<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; Key</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="Key">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Key</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds some constants and provides converters for parse_data().&quot;&quot;&quot;</span>

    <span class="c1"># General type information keys</span>
    <span class="n">BINARY</span> <span class="o">=</span> <span class="s1">&#39;binary&#39;</span>
    <span class="n">SRV_CHECK</span> <span class="o">=</span> <span class="s1">&#39;srv_check&#39;</span>
    <span class="n">SIZE</span> <span class="o">=</span> <span class="s1">&#39;size&#39;</span>

    <span class="n">OFFSET</span> <span class="o">=</span> <span class="s1">&#39;offset&#39;</span>

    <span class="c1"># Attribute/array keys</span>
    <span class="n">TYPE_NAME</span> <span class="o">=</span> <span class="s1">&#39;type&#39;</span>

    <span class="c1"># Array keys</span>
    <span class="n">LENGTH</span> <span class="o">=</span> <span class="s1">&#39;length&#39;</span>

    <span class="c1"># Pointer keys</span>
    <span class="n">LEVEL</span> <span class="o">=</span> <span class="s1">&#39;level&#39;</span>
    <span class="n">ACCESSOR</span> <span class="o">=</span> <span class="s1">&#39;accessor&#39;</span>
    <span class="n">ACCESSOR_OFFSET</span> <span class="o">=</span> <span class="s1">&#39;accessor_offset&#39;</span>

    <span class="c1"># (Virtual) function keys</span>
    <span class="n">ARGS</span> <span class="o">=</span> <span class="s1">&#39;arguments&#39;</span>
    <span class="n">RETURN_TYPE</span> <span class="o">=</span> <span class="s1">&#39;return_type&#39;</span>
    <span class="n">CONVENTION</span> <span class="o">=</span> <span class="s1">&#39;convention&#39;</span>
    <span class="n">IDENTIFIER</span> <span class="o">=</span> <span class="s1">&#39;identifier&#39;</span>

    <span class="c1"># Shared keys</span>
    <span class="n">DOC</span> <span class="o">=</span> <span class="s1">&#39;doc&#39;</span>

<div class="viewcode-block" id="Key.as_bool">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_bool">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_bool</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string to a boolean.</span>

<span class="sd">        Raises a ValueError if the string doesn&#39;t represent such a value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;false&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;Cannot convert &quot;</span><span class="si">{0}</span><span class="s1">&quot; to a boolean value.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span></div>


<div class="viewcode-block" id="Key.as_args_tuple">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_args_tuple">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_args_tuple</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string into a tuple containing &lt;DataType&gt; elements.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="p">)</span>

        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">DataType</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="Key.as_return_type">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_return_type">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_return_type</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string into a &lt;Return&gt; object.</span>

<span class="sd">        If the conversion fails, the string itself will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DataType</span><span class="o">.</span><span class="n">names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="Key.as_identifier">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_identifier">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_identifier</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string into a byte string.</span>

<span class="sd">        If no spaces in the string, the string itself will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39; &#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Key.as_convention">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_convention">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_convention</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string into a &lt;Convention&gt; object.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Convention</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">manager</span><span class="o">.</span><span class="n">custom_conventions</span><span class="p">[</span><span class="n">value</span><span class="p">]</span></div>


<div class="viewcode-block" id="Key.as_attribute_type">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_attribute_type">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_attribute_type</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a string into a &lt;Type&gt; value.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Type</span><span class="o">.</span><span class="n">is_native</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Key.as_str">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_str">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_str</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the value to a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="Key.as_int">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Key.as_int">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">as_int</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert the value to an integer.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span></div>
</div>



<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; BasePointer</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="BasePointer">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.BasePointer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BasePointer</span><span class="p">(</span><span class="n">Pointer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pointer extension class.&quot;&quot;&quot;</span>

    <span class="c1"># These four operator functions are required. Otherwise we would downcast</span>
    <span class="c1"># the instance to the Pointer class if we add or subtract bytes.</span>
    <span class="c1"># TODO: Can we do that on the C++ side?</span>
    <span class="c1"># If yes, this class would be redundant.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return self+value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">make_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Pointer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value+self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return self-value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">make_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">Pointer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return value-self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span></div>



<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; Array</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="Array">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Array">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Array</span><span class="p">(</span><span class="n">BasePointer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrap an array.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Array.__init__">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Array.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="p">,</span> <span class="n">is_ptr</span><span class="p">,</span> <span class="n">type_name</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the array wrapper.</span>

<span class="sd">        :param TypeManager manager: The manager that should be used to</span>
<span class="sd">            retrieve classes.</span>
<span class="sd">        :param bool is_ptr: Set to True if the array contains pointers.</span>
<span class="sd">        :param str type_name: The name of the array type. E.g. &#39;Vector&#39; or</span>
<span class="sd">            &#39;bool&#39;.</span>
<span class="sd">        :param Pointer ptr: The base address of the array (the very first</span>
<span class="sd">            array entry).</span>
<span class="sd">        :param int|None length: Length of the array. Setting this value allows</span>
<span class="sd">            you to iterate over the array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="n">manager</span>

        <span class="c1"># Set to True if the array contains pointers, else False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_ptr</span> <span class="o">=</span> <span class="n">is_ptr</span>

        <span class="c1"># Contains the type name of the array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span> <span class="o">=</span> <span class="n">type_name</span>

        <span class="c1"># Optional -- specifies the length of the array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="o">=</span> <span class="n">length</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the value at the given index.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_attribute</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the value at the given index.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_make_attribute</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a generator that can iterate over the array.&quot;&quot;&quot;</span>
        <span class="c1"># This prevents users from iterating over the array without having</span>
        <span class="c1"># _length specified. Otherwise the server would hang or crash.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Cannot iterate over the array without _length being specif&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;ied.&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the index and returns a new property object.&quot;&quot;&quot;</span>
        <span class="c1"># Validate the index, so we don&#39;t access invalid memory addresses</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_length</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;Index out of range&#39;</span><span class="p">)</span>

        <span class="c1"># Construct the proper function name</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;pointer&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ptr</span> <span class="k">else</span> <span class="s1">&#39;instance&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_attribute&#39;</span>

        <span class="c1"># Get the function and call it</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="p">,</span> <span class="n">name</span><span class="p">)(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_offset</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="Array.get_offset">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.Array.get_offset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the offset of the given index.&quot;&quot;&quot;</span>
        <span class="c1"># Pointer arrays always have every 4 bytes a new pointer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_ptr</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index</span> <span class="o">*</span> <span class="n">TYPE_SIZES</span><span class="p">[</span><span class="s1">&#39;POINTER&#39;</span><span class="p">]</span>

        <span class="c1"># Every 1, 2, 4 or 8 bytes is a new value</span>
        <span class="k">if</span> <span class="n">Type</span><span class="o">.</span><span class="n">is_native</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">index</span> <span class="o">*</span> <span class="n">TYPE_SIZES</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

        <span class="c1"># Get the class of the custom type</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">get_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Unknown class &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">))</span>

        <span class="c1"># To access a value, we require the proper size of a custom type</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Array requires a size to access its values.&#39;</span><span class="p">)</span>

        <span class="c1"># Every x bytes is a new instance</span>
        <span class="k">return</span> <span class="n">index</span> <span class="o">*</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_size</span></div>


    <span class="c1"># Arrays have another constructor and we don&#39;t want to downcast. So, we</span>
    <span class="c1"># have to implement these operators here again.</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add bytes or another pointer to the base address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_ptr</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtract bytes or another pointer from the base address.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_ptr</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_length</span>
        <span class="p">)</span></div>



<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; MemberFunction</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="MemberFunction">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.MemberFunction">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MemberFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use this class to create a wrapper for member functions.</span>

<span class="sd">    It passes the this pointer automatically to the wrapped function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MemberFunction.__init__">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.MemberFunction.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="p">,</span> <span class="n">return_type</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">this</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the instance.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_function</span> <span class="o">=</span> <span class="n">func</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="c1"># This should always hold a TypeManager instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="n">manager</span>

        <span class="c1"># Holds the this pointer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_this</span> <span class="o">=</span> <span class="n">this</span>

        <span class="c1"># Holds the return type name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_type_name</span> <span class="o">=</span> <span class="n">return_type</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the function dynamically.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_this</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<div class="viewcode-block" id="MemberFunction.call_trampoline">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.MemberFunction.call_trampoline">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">call_trampoline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the trampoline dynamically.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">call_trampoline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_this</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="MemberFunction.skip_hooks">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.MemberFunction.skip_hooks">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">skip_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call the function, but skip hooks if there are any.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">skip_hooks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_this</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></div>
</div>



<span class="c1"># =============================================================================</span>
<span class="c1"># &gt;&gt; FUNCTIONS</span>
<span class="c1"># =============================================================================</span>
<div class="viewcode-block" id="parse_data">
<a class="viewcode-back" href="../../developing/modules/memory.helpers.html#memory.helpers.parse_data">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">parse_data</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">raw_data</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse the data dictionary.</span>

<span class="sd">    Parses by converting the values of the given keys into</span>
<span class="sd">    the proper type or assigning them default values. Raises a KeyError if a</span>
<span class="sd">    key does not exist and if no default value is available.</span>

<span class="sd">    Returns a generator: (&lt;name&gt;, [&lt;value of key0&gt;, &lt;value of key1&gt;, ...])</span>

<span class="sd">    &lt;keys&gt; must have the following structure:</span>
<span class="sd">    ((&lt;key name&gt;, &lt;converter&gt;, &lt;default value&gt;), ...)</span>
<span class="sd">    </span>
<span class="sd">    The convert function must accept 2 arguments:</span>
<span class="sd">    </span>
<span class="sd">    1. An instance of the TypeManager class</span>
<span class="sd">    2. The value to convert</span>


<span class="sd">    Information about data that comes from a file:</span>

<span class="sd">    You can specialize every key by adding &#39;&#39;_windows&#39;&#39; (for Windows) or</span>
<span class="sd">    &#39;&#39;_linux&#39;&#39; (for Linux) to the end a key.</span>

<span class="sd">    For example:</span>
<span class="sd">    If you are using a signature on Windows, but a symbol on Linux, you have</span>
<span class="sd">    three possibilities to do that:</span>

<span class="sd">    1.</span>
<span class="sd">    identifier_windows = &lt;signature for Windows&gt;</span>
<span class="sd">    identifier         = &lt;symbol for Linux&gt;</span>

<span class="sd">    2.</span>
<span class="sd">    identifier         = &lt;signature for Windows&gt;</span>
<span class="sd">    identifier_linux   = &lt;symbol for Linux&gt;</span>

<span class="sd">    3.</span>
<span class="sd">    identifier_windows = &lt;signature for Windows&gt;</span>
<span class="sd">    identifier_linux   = &lt;symbol for Linux&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">converter</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="c1"># Get the OS specific key. If that fails, fall back to the shared</span>
            <span class="c1"># key. If that fails too, use the default value</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">PLATFORM</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">))</span>

            <span class="c1"># If the value is NO_DEFAULT, the key is obviously missing</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">NO_DEFAULT</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="s1">&#39;Missing information for key &quot;</span><span class="si">{0}</span><span class="s1">&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

            <span class="n">temp_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">value</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">default</span> <span class="k">else</span> <span class="n">converter</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

        <span class="k">yield</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">temp_data</span><span class="p">)</span></div>


<span class="c1"># Use this as a default value if the key is not allowed to have a default</span>
<span class="c1"># value</span>
<span class="n">NO_DEFAULT</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/sp_wiki_banner.png" alt="Logo of  Source.Python"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html"> Source.Python  v742 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../memory.html" >memory</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">memory.helpers</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2025,  Source.Python Development Team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>